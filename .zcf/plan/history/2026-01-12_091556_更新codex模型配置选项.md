# 任务计划：更新 Codex 模型配置选项

## 任务概述

将 Codex 的模型配置选项从旧的三个选项更新为新的三个选项，并将默认模型改为 `gpt-5.2`。

## 新模型选项

| 选项 | 模型 ID | 描述 |
|------|---------|------|
| 1 | `gpt-5.1-codex-max` | Codex-optimized flagship for deep and fast reasoning |
| 2 | `gpt-5.1-codex-mini` | Optimized for codex. Cheaper, faster, but less capable |
| 3 (默认) | `gpt-5.2` | Latest frontier model with improvements across knowledge, reasoning and coding |
| 4 | 自定义 | 用户自定义模型名称 |

## 执行步骤

### Step 1: 更新 src/utils/features.ts

**文件**: `src/utils/features.ts`
**函数**: `configureCodexDefaultModelFeature()`

**变更内容**:
1. 修改 `inquirer.prompt` 中的 choices 数组，将三个选项改为新模型
2. 将默认值从 `gpt-5-codex` 改为 `gpt-5.2`
3. 更新 `modelDisplay` 逻辑以正确显示新模型名称

**预期结果**: 用户在配置 Codex 默认模型时看到新的三个选项

---

### Step 2: 更新 src/utils/code-tools/codex.ts

**文件**: `src/utils/code-tools/codex.ts`

**变更位置**:
1. Line ~1701: `default: 'gpt-5-codex'` → `default: 'gpt-5.2'`
2. Line ~1749: `model: customModel || prefilledModel || 'gpt-5-codex'` → `model: customModel || prefilledModel || 'gpt-5.2'`
3. Line ~2201-2205: 更新 `switchToProvider()` 中的模型判断逻辑

**预期结果**: 所有默认模型值变为 `gpt-5.2`

---

### Step 3: 更新 src/utils/code-tools/codex-config-switch.ts

**文件**: `src/utils/code-tools/codex-config-switch.ts`

**变更位置**:
1. Line ~179: `model: prefilledModel || 'gpt-5-codex'` → `model: prefilledModel || 'gpt-5.2'`
2. Line ~292: `default: provider.model || 'gpt-5-codex'` → `default: provider.model || 'gpt-5.2'`
3. Line ~406: `default: provider.model || 'gpt-5-codex'` → `default: provider.model || 'gpt-5.2'`

**预期结果**: 配置切换时默认模型为 `gpt-5.2`

---

### Step 4: 更新 src/commands/init.ts

**文件**: `src/commands/init.ts`

**变更位置**:
1. Line ~1386: `let model = config.primaryModel || 'gpt-5-codex'` → `let model = config.primaryModel || 'gpt-5.2'`

**预期结果**: 初始化命令使用新的默认模型

---

### Step 5: 更新中文翻译文件

**文件**: `src/i18n/locales/zh-CN/configuration.json`

**变更内容**:
```json
{
  "codexModelOptions.gpt51CodexMax": "GPT-5.1-Codex-Max - Codex 优化旗舰模型，支持深度快速推理",
  "codexModelOptions.gpt51CodexMini": "GPT-5.1-Codex-Mini - Codex 优化版，更便宜快速但能力稍弱",
  "codexModelOptions.gpt52": "GPT-5.2 - 最新前沿模型，知识、推理和编码全面提升（推荐）",
  "codexModelOptions.custom": "自定义 - 指定自定义模型名称"
}
```

**文件**: `src/i18n/locales/zh-CN/menu.json`
- 更新 `menuDescriptions.codexConfigureModel` 描述

**文件**: `src/i18n/locales/zh-CN/codex.json`
- 更新 `providerModelPrompt` 提示文本

---

### Step 6: 更新英文翻译文件

**文件**: `src/i18n/locales/en/configuration.json`

**变更内容**:
```json
{
  "codexModelOptions.gpt51CodexMax": "GPT-5.1-Codex-Max - Codex-optimized flagship for deep and fast reasoning",
  "codexModelOptions.gpt51CodexMini": "GPT-5.1-Codex-Mini - Optimized for codex. Cheaper, faster, but less capable",
  "codexModelOptions.gpt52": "GPT-5.2 - Latest frontier model with improvements across knowledge, reasoning and coding (Recommended)",
  "codexModelOptions.custom": "Custom - Specify custom model names"
}
```

**文件**: `src/i18n/locales/en/menu.json`
- 更新 `menuDescriptions.codexConfigureModel` 描述

**文件**: `src/i18n/locales/en/codex.json`
- 更新 `providerModelPrompt` 提示文本

---

### Step 7: 运行测试验证

**命令**: `pnpm test:run`

**验证点**:
1. 确保没有测试失败
2. 确保类型检查通过 (`pnpm typecheck`)
3. 确保 lint 检查通过 (`pnpm lint`)

---

## 风险评估

| 风险 | 等级 | 缓解措施 |
|------|------|---------|
| 遗漏某处默认值 | 低 | 使用 grep 全局搜索确认 |
| 翻译不一致 | 低 | 同时更新中英文文件 |
| 测试失败 | 中 | 运行完整测试套件验证 |

## 回滚方案

如果出现问题，可以通过 git 回滚：
```bash
git checkout -- src/utils/features.ts src/utils/code-tools/codex.ts src/utils/code-tools/codex-config-switch.ts src/commands/init.ts src/i18n/
```
